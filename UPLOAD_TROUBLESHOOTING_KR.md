# 📤 작업자 엑셀 업로드 문제 해결 가이드

## 🎯 귀하의 파일 상태

### ✅ 분석 결과: **파일에 문제 없음!**

```
파일명: worker_template.xlsx
형식: Microsoft Excel (.xlsx) ✅
시트명: Workers ✅
헤더: No, Entity, Name, Employee ID, Team, Position, Start to work date ✅
데이터: 143명 ✅
필수 항목: 모두 포함 ✅
```

**결론**: 귀하의 엑셀 파일은 **완벽하게 정상**입니다!

---

## 🔍 업로드 실패 원인 찾기

파일 자체에는 문제가 없으므로, 다음 단계를 따라 **정확한 오류 원인**을 찾아보겠습니다.

### 📋 단계 1: 브라우저 개발자 도구 열기

#### Windows / Linux:
- `F12` 키 누르기
- 또는 `Ctrl + Shift + I`

#### Mac:
- `Cmd + Option + I`

#### 또는 마우스 사용:
- 페이지에서 마우스 우클릭
- "검사" 또는 "개발자 도구" 선택

---

### 📋 단계 2: Console 탭에서 로그 확인

1. **Console 탭 클릭**
2. **기존 로그 지우기** (🚫 아이콘 클릭)
3. **파일 업로드 시도**
4. **다음과 같은 로그가 나타나는지 확인:**

```
📂 파일 읽기 시작...
📊 읽은 행 수: 143개
🔍 첫 번째 행 컬럼: ["No", "Entity", "Name", "Employee ID", "Team", "Position", "Start to work date"]
🔍 첫 번째 데이터 샘플: {No: 1, Entity: "CSVN", Name: "...", ...}
✅ 형식 1 감지 (Entity, Team 컬럼 존재)
📋 행 2 변환 결과: {employee_id: "3452", name: "...", ...}
✅ 총 143개 데이터 변환 완료
✅ 필수 항목 검증 통과
📤 API 전송 시작...
```

---

### 📋 단계 3: 오류 메시지 확인

#### ❌ 만약 빨간색 오류가 나타난다면:

**오류 A: "Network Error" 또는 "Failed to fetch"**
```
❌ 작업자 업로드 실패: Network Error
```
- **원인**: 네트워크 연결 문제 또는 서버 다운
- **해결**: 
  1. 인터넷 연결 확인
  2. 페이지 새로고침 (F5)
  3. 서버 상태 확인

**오류 B: "지원하지 않는 엑셀 파일 형식"**
```
❌ 지원하지 않는 형식. 발견된 컬럼: ...
```
- **원인**: 헤더 이름이 정확하지 않음
- **해결**: 엑셀 첫 번째 행의 컬럼명 확인
  - `Entity` (대문자 E)
  - `Team` (대문자 T)
  - `Employee ID` (공백 포함)
  - `Start to work date` (공백 포함)

**오류 C: "필수 항목이 누락"**
```
❌ 행 5 검증 실패: {employee_id: "", name: "...", ...}
```
- **원인**: 특정 행에 빈 값이 있음
- **해결**: 오류 메시지에 표시된 행 번호로 이동하여 빈 셀 채우기

**오류 D: "500 Internal Server Error"**
```
❌ 에러 상세: {status: 500, message: "..."}
```
- **원인**: 서버 오류 (데이터베이스 문제, 중복 키 등)
- **해결**: 
  1. 콘솔에서 정확한 에러 메시지 확인
  2. 중복된 Employee ID가 있는지 확인
  3. 관리자에게 문의

---

### 📋 단계 4: Network 탭에서 API 응답 확인

1. **Network 탭 클릭**
2. **파일 업로드 시도**
3. **`workers/bulk` 또는 `/api/workers/bulk` 항목 찾기**
4. **클릭하여 상세 정보 확인**

#### Headers 탭:
```
Request URL: http://localhost:3000/api/workers/bulk
Request Method: POST
Status Code: 201 Created (성공)
Status Code: 400 Bad Request (클라이언트 오류)
Status Code: 500 Internal Server Error (서버 오류)
```

#### Response 탭:
- 성공: `{"success": true, "count": 143}`
- 실패: `{"error": "오류 메시지"}`

#### Payload 탭:
- 실제 전송된 데이터 확인

---

## 🛠️ 일반적인 해결 방법

### 방법 1: 엑셀 파일 재저장

가장 간단하고 효과적인 방법입니다!

1. **엑셀 파일 열기**
2. **"다른 이름으로 저장" 선택**
3. **파일 형식: "Excel 통합 문서 (*.xlsx)" 선택**
4. **저장**
5. **새로 저장한 파일로 업로드**

---

### 방법 2: Employee ID를 텍스트로 변환

#### Excel에서:
1. **Employee ID 열(D열) 전체 선택**
2. **마우스 우클릭 → "셀 서식"**
3. **"텍스트" 선택 → "확인"**
4. **각 셀을 더블클릭하여 Enter 키 (또는 F2 → Enter)**
5. **저장 후 업로드**

#### 또는 간단한 방법:
1. **Employee ID 셀 편집**
2. **숫자 앞에 작은따옴표(') 추가**
   - 예: `3452` → `'3452`
3. **Enter 키**
4. **모든 ID에 동일하게 적용**

---

### 방법 3: 작은 단위로 테스트

1. **엑셀 파일에서 처음 10개 행만 복사**
   - 헤더 + 10명의 데이터
2. **새 엑셀 파일에 붙여넣기**
3. **새 파일로 저장**
4. **업로드 테스트**
5. **성공하면 점진적으로 데이터 추가**

---

### 방법 4: 중복 데이터 제거

시스템에 이미 동일한 Employee ID가 있을 수 있습니다.

1. **"작업자 등록" 페이지 접속**
2. **"등록된 작업자 현황" 섹션 확인**
3. **각 법인(CSVN, CSCN, CSTW)의 리스트 펼치기**
4. **업로드할 파일의 Employee ID와 비교**
5. **중복이 있다면 엑셀에서 해당 행 삭제**

---

### 방법 5: UTF-8 인코딩 확인

베트남어 이름 등 특수 문자가 깨질 수 있습니다.

1. **Google Sheets 사용** (권장):
   - 엑셀 파일을 Google Sheets에 업로드
   - "파일" → "다운로드" → "Microsoft Excel (.xlsx)"
   - 다운로드한 파일로 업로드

2. **또는 LibreOffice 사용**:
   - LibreOffice Calc에서 열기
   - "다른 이름으로 저장" → "Microsoft Excel 2007-365 (.xlsx)"
   - UTF-8 인코딩 확인

---

## 📊 업로드 성공 확인 방법

업로드가 성공하면:

1. **알림창 표시**:
   ```
   ✅ 143명의 작업자가 성공적으로 등록되었습니다.
   ```

2. **콘솔 로그**:
   ```
   🎉 업로드 성공: {success: true, count: 143}
   ```

3. **등록된 작업자 현황 자동 업데이트**:
   - 법인별 그룹에 새 작업자가 표시됨
   - 인원 수가 증가함

---

## 🆘 여전히 실패하는 경우

### 필요한 정보:

1. **브라우저 Console 로그 전체 복사**
   - F12 → Console 탭
   - 로그 전체 선택 → 복사

2. **Network 탭의 Response**
   - F12 → Network 탭
   - `/api/workers/bulk` 클릭
   - Response 탭 내용 복사

3. **엑셀 파일 첫 5행 스크린샷**

4. **사용 중인 브라우저와 버전**
   - 예: Chrome 120, Firefox 121, Safari 17

### 문의 방법:

위의 정보와 함께 다음 사항을 알려주세요:

1. 어느 단계에서 실패하는지 (파일 선택? 업로드 버튼 클릭?)
2. 오류 메시지 전문
3. 시도한 해결 방법

---

## ✅ 체크리스트

업로드 전 확인사항:

- [ ] 엑셀 파일 형식이 `.xlsx`인가?
- [ ] 시트 이름이 "Workers"인가?
- [ ] 헤더가 정확한가? (대소문자, 공백 확인)
- [ ] 모든 행에 필수 항목이 채워져 있는가?
- [ ] Employee ID에 중복이 없는가?
- [ ] 브라우저 개발자 도구를 열었는가?
- [ ] 인터넷 연결이 정상인가?

---

## 🎯 요약

### 귀하의 파일: ✅ **정상**

### 가장 가능성 높은 원인:
1. Employee ID가 숫자 타입으로 저장됨
2. 중복된 Employee ID가 이미 DB에 존재
3. 네트워크 또는 서버 문제

### 권장 해결 방법 순서:
1. ⭐ **브라우저 개발자 도구(F12)로 정확한 오류 확인**
2. 엑셀 파일 "다른 이름으로 저장"
3. Employee ID를 텍스트로 변환
4. 작은 단위(10개)로 테스트 업로드
5. 중복 데이터 확인 및 제거

### 새로운 디버깅 기능:
✅ 이제 업로드 시 **상세한 로그**가 브라우저 콘솔에 표시됩니다!
✅ 어느 단계에서 실패하는지 **정확히 알 수 있습니다**!

---

**추가 질문이나 도움이 필요하시면 위의 정보를 함께 제공해주세요!** 🙏
